import{R as Q,y as C,J as b,r as E,j as f,P as d}from"./index-ChOKem0X.js";const I=["javascripts/jQuery/ui/css/redmond/jquery-ui.css","css/widgets.css","css/dhis-web-dataentry.css","css/select2/select2.css"],P=["javascripts/jQuery/jquery.min.js","javascripts/jQuery/placeholders.jquery.min.js","javascripts/jQuery/jquery.utils.js","javascripts/jQuery/jquery.ext.js","javascripts/jQuery/jquery.metadata.js","javascripts/jQuery/jquery.tablesorter.min.js","javascripts/jQuery/jquery.upload-1.0.2.min.js","javascripts/jQuery/jquery.dhisAjaxSelect.js","javascripts/jQuery/ui/jquery-ui.min.js","javascripts/jQuery/ui/jquery.blockUI.js","javascripts/jQuery/jquery.validate.js","javascripts/jQuery/jquery.validate.ext.js","javascripts/jQuery/jquery.cookie.js","javascripts/jQuery/jquery.glob.js","javascripts/jQuery/jquery.date.js","javascripts/jQuery/jquery.tmpl.js","javascripts/jQuery/jquery.autogrow.js","javascripts/jQuery/jquery.fileupload.min.js","javascripts/dhis2/dhis2.util.js","javascripts/dhis2/dhis2.array.js","javascripts/dhis2/dhis2.select.js","javascripts/jQuery/calendars/jquery.calendars.min.js","javascripts/jQuery/calendars/jquery.calendars.plus.min.js","javascripts/select2.min.js","javascripts/floatThead/jquery.floatThead.min.js","javascripts/dhis2/dhis2.period.js","javascripts/dhis2/dhis2.selected.js","javascripts/dhis2/dhis2.comparator.js","javascripts/dhis2/dhis2.availability.js","javascripts/dhis2/dhis2.trigger.js","javascripts/dhis2/dhis2.sharing.js","javascripts/dhis2/dhis2.validation.js","javascripts/dhis2/dhis2.contextmenu.js","javascripts/dhis2/dhis2.appcache.js","javascripts/dhis2/dhis2.translate.js","javascripts/data-entry/form.js","javascripts/data-entry/entry.js"],T=()=>{const o=P.map(r=>{const e=document.createElement("script");return e.src=`legacy-custom-forms/${r}`,e.async=!1,e}),n=I.map(r=>{const e=document.createElement("link");return e.href=`legacy-custom-forms/${r}`,e.type="text/css",e.rel="stylesheet",e});return{externalScripts:o,externalCSS:n}},A=({periodId:o,dataSetId:n,attributeOptionComboSelection:r,baseUrl:e,metadata:t,orgUnitId:c,hideAlert:w,showAlert:h,setHighlightedField:v,saveValue:g})=>{var u,l,p;const a=document.createElement("input");a.id="selectedPeriodId",a.value=o,a.hidden=!0;const j=document.createElement("input");j.id="selectedDataSetId",j.value=n,j.hidden=!0,r&&Object.keys(r).forEach(i=>{const s=document.createElement("input");s.id=`category-${i}`,s.value=r[i],s.hidden=!0,document.body.append(s)}),document.body.append(a,j),window.dhis2.de.currentOrganisationUnitId=c,window.dhis2.de.currentDataSetId=n,window.dhis2.de.currentPeriodId=o,window.dhis2.de.defaultCategoryCombo=(p=(l=(u=Object.values(t.categoryCombos))==null?void 0:u.find)==null?void 0:l.call(u,i=>i.isDefault))==null?void 0:p.id,window.dhis2.de.categories=t.categories,window.dhis2.de.categoryCombos=t.categoryCombos,window.dhis2.de.dataElements=t.dataElements,window.dhis2.de.optionSets=t.optionSets,window.dhis2.de.indicatorFormulas=t.indicators;const m={};for(const[i,s]of Object.entries(t.dataSets))m[i]={...s,periodId:s==null?void 0:s.period};window.dhis2.de.dataSets=m;//! it's also a pseudo-security measure, as it basically ensures that all calls are to the DHIS2 server - no outside API calls
window.DHIS_BASE_URL=e+"/",window.$.ajaxSetup({beforeSend:function(i,s){var y;(y=s.url)!=null&&y.match(e)||(s.url=e+s.url),s.xhrFields={...s.xhrFields,withCredentials:!0}}}),window.dhis2.period.format="$dateFormat.js",window.dhis2.period.calendar=window.$.calendars.instance("gregorian"),window.dhis2.period.generator=new window.dhis2.period.PeriodGenerator(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.period.picker=new window.dhis2.period.DatePicker(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.shim=window.dhis2.shim||{},window.dhis2.shim.showAlert=h,window.dhis2.shim.hideAlert=w,window.setHeaderDelayMessage=i=>{h({message:i})},window.dhis2.shim.metadata=t,window.dhis2.shim.setHighlightedField=v,window.dhis2.shim.saveValue=(i,s)=>{g(i,s)}},R=o=>{const n=o.getElementsByTagName("script"),r=o.getElementsByTagName("style"),e=[];return Array.from(n).forEach(t=>{const c=document.createElement("script");c.textContent=t.textContent,c.async=!1,e.push(c),t.remove()}),{scripts:e??[],styles:r??[]}},{externalCSS:H,externalScripts:L}=T(),k=Q.memo(function(n){var y;const{htmlCode:r,metadata:e,saveValue:t,periodId:c,dataSetId:w,orgUnitId:h,attributeOptionComboSelection:v,setHighlightedField:g}=n;console.log("[custom-forms] ðŸ Legacy Custom Form Plugin starting ðŸ");const a=C(),j=new DOMParser().parseFromString(r,"text/html"),m=R(j),u=j.body.innerHTML,l=m.scripts,p=m.styles,{show:i,hide:s}=b(({message:S})=>S,{warning:!0});return E.useEffect(()=>{if(!r||!p||!l)return;document.body.append(...L),document.getElementsByTagName("head")[0].append(...H,...p),setTimeout(()=>{var q,x,F;A({periodId:c,dataSetId:w,attributeOptionComboSelection:v,baseUrl:(q=a==null?void 0:a.systemInfo)==null?void 0:q.contextPath,metadata:e,orgUnitId:h,hideAlert:s,showAlert:i,setHighlightedField:g,saveValue:t}),document.body.append(...l);//! Kick off everything ðŸš€
(F=(x=window.dhis2)==null?void 0:x.de)==null||F.loadForm()},1e3)},[(y=a==null?void 0:a.systemInfo)==null?void 0:y.contextPath,w,s,r,e,e.dataSets,h,l,c,i,p,v,g,t]),f.jsx("div",{children:f.jsx("div",{children:f.jsx("div",{className:"cde-NORMAL",dangerouslySetInnerHTML:{__html:u}})})})});k.propTypes={dataSetId:d.string.isRequired,htmlCode:d.string.isRequired,orgUnitId:d.string.isRequired,periodId:d.string.isRequired,attributeOptionComboSelection:d.object,dataSet:d.shape({displayName:d.string}),initialValues:d.shape({}),metadata:d.object,saveValue:d.func,setHighlightedField:d.func};export{k as default};
//# sourceMappingURL=index-mHZ-Rl8w.js.map
