import{v as r,R as Q,y as b,J as E,r as I,j as S,P as d}from"./index-ChOKem0X.js";import"./index-Bah48F4K.js";const D=["javascripts/jQuery/ui/css/redmond/jquery-ui.css","css/widgets.css","css/dhis-web-dataentry.css","css/select2/select2.css"],T=["javascripts/jQuery/jquery.min.js","javascripts/jQuery/placeholders.jquery.min.js","javascripts/jQuery/jquery.utils.js","javascripts/jQuery/jquery.ext.js","javascripts/jQuery/jquery.metadata.js","javascripts/jQuery/jquery.tablesorter.min.js","javascripts/jQuery/jquery.upload-1.0.2.min.js","javascripts/jQuery/jquery.dhisAjaxSelect.js","javascripts/jQuery/ui/jquery-ui.min.js","javascripts/jQuery/ui/jquery.blockUI.js","javascripts/jQuery/jquery.validate.js","javascripts/jQuery/jquery.validate.ext.js","javascripts/jQuery/jquery.cookie.js","javascripts/jQuery/jquery.glob.js","javascripts/jQuery/jquery.date.js","javascripts/jQuery/jquery.tmpl.js","javascripts/jQuery/jquery.autogrow.js","javascripts/jQuery/jquery.fileupload.min.js","javascripts/dhis2/dhis2.util.js","javascripts/dhis2/dhis2.array.js","javascripts/dhis2/dhis2.select.js","javascripts/jQuery/calendars/jquery.calendars.min.js","javascripts/jQuery/calendars/jquery.calendars.plus.min.js","javascripts/select2.min.js","javascripts/floatThead/jquery.floatThead.min.js","javascripts/dhis2/dhis2.period.js","javascripts/dhis2/dhis2.validation.js","javascripts/data-entry/entry.fileresource.js","javascripts/data-entry/form.js","javascripts/data-entry/entry.js"],P=()=>{const n=T.map(a=>{const s=document.createElement("script");return s.src=`legacy-custom-forms/${a}`,s.async=!1,s}),c=D.map(a=>{const s=document.createElement("link");return s.href=`legacy-custom-forms/${a}`,s.type="text/css",s.rel="stylesheet",s});return{externalScripts:n,externalCSS:c}},A=({periodId:n,dataSetId:c,attributeOptionComboSelection:a,baseUrl:s,metadata:t,orgUnitId:l,hideAlert:f,showAlert:h,setHighlightedField:g,saveValue:v,showDetailsBar:_})=>{var j,m,p;const o=document.createElement("input");o.id="selectedPeriodId",o.value=n,o.hidden=!0;const u=document.createElement("input");u.id="selectedDataSetId",u.value=c,u.hidden=!0,a&&Object.keys(a).forEach(i=>{const e=document.createElement("input");e.id=`category-${i}`,e.value=a[i],e.hidden=!0,document.body.append(e)}),document.body.append(o,u),window.dhis2.de.currentOrganisationUnitId=l,window.dhis2.de.currentDataSetId=c,window.dhis2.de.currentPeriodId=n,window.dhis2.de.defaultCategoryCombo=(p=(m=(j=Object.values(t.categoryCombos))==null?void 0:j.find)==null?void 0:m.call(j,i=>i.isDefault))==null?void 0:p.id,window.dhis2.de.categories=t.categories,window.dhis2.de.categoryCombos=t.categoryCombos,window.dhis2.de.dataElements=t.dataElements,window.dhis2.de.optionSets=t.optionSets,window.dhis2.de.indicatorFormulas=t.indicators;const y={};for(const[i,e]of Object.entries(t.dataSets))y[i]={...e,periodId:e==null?void 0:e.period};window.dhis2.de.dataSets=y;//! it's also a pseudo-security measure, as it basically ensures that all calls are to the DHIS2 server - no outside API calls
window.DHIS_BASE_URL=s+"/",window.$.ajaxSetup({beforeSend:function(i,e){var w;(w=e.url)!=null&&w.match(s)||(e.url=s+e.url),e.xhrFields={...e.xhrFields,withCredentials:!0}}}),window.dhis2.period.format="$dateFormat.js",window.dhis2.period.calendar=window.$.calendars.instance("gregorian"),window.dhis2.period.generator=new window.dhis2.period.PeriodGenerator(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.period.picker=new window.dhis2.period.DatePicker(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.shim=window.dhis2.shim||{},window.dhis2.shim.showAlert=h,window.dhis2.shim.hideAlert=f,window.setHeaderDelayMessage=i=>{h({message:i})},window.dhis2.shim.metadata=t,window.dhis2.shim.setHighlightedField=g,window.dhis2.shim.saveValue=(i,e)=>{v(i,e)},window.dhis2.shim.showDetailsBar=_,window.dhis2.shim.i18n_translations={i18n_loading_file_info_failed:r.t("Loading file info failed"),i18n_file_upload_failed:r.t("File upload failed"),i18n_confirm_deletion:r.t("Confirm deletion"),i18n_dataset_is_concluded:r.t("Dataset is concluded"),i18n_dataset_is_closed:r.t("Dataset is closed"),i18n_dataset_is_approved:r.t("Dataset is approved"),i18n_dataset_is_locked:r.t("Dataset is locked"),i18n_orgunit_is_closed:r.t("Org unit is closed"),i18n_select_option:r.t("Choose an option"),i18n_show_all_items:r.t("Show all items"),i18n_value_of_data_element_greater:r.t("The value of the following data element is less than the specified minimum value."),i18n_value_of_data_element_less:r.t("The value of the following data element is greater than the specified maximum value.")}},k=n=>{const c=n.getElementsByTagName("script"),a=n.getElementsByTagName("style"),s=[];return Array.from(c).forEach(t=>{const l=document.createElement("script");l.textContent=t.textContent,l.async=!1,s.push(l),t.remove()}),{scripts:s??[],styles:a??[]}},{externalCSS:L,externalScripts:R}=P(),B=Q.memo(function(c){var w;const{htmlCode:a,metadata:s,saveValue:t,periodId:l,dataSetId:f,orgUnitId:h,attributeOptionComboSelection:g,setHighlightedField:v,showDetailsBar:_}=c;console.log("[custom-forms] ðŸ Legacy Custom Form Plugin starting ðŸ");const o=b(),u=new DOMParser().parseFromString(a,"text/html"),y=k(u),j=u.body.innerHTML,m=y.scripts,p=y.styles,{show:i,hide:e}=E(({message:x})=>x,{warning:!0});return I.useEffect(()=>{if(!a||!p||!m)return;document.body.append(...R),document.getElementsByTagName("head")[0].append(...L,...p),setTimeout(()=>{var q,C,F;A({periodId:l,dataSetId:f,attributeOptionComboSelection:g,baseUrl:(q=o==null?void 0:o.systemInfo)==null?void 0:q.contextPath,metadata:s,orgUnitId:h,hideAlert:e,showAlert:i,setHighlightedField:v,saveValue:t,showDetailsBar:_}),document.body.append(...m);//! Kick off everything ðŸš€
(F=(C=window.dhis2)==null?void 0:C.de)==null||F.loadForm()},1e3)},[(w=o==null?void 0:o.systemInfo)==null?void 0:w.contextPath,f,e,a,s,s.dataSets,h,m,l,i,p,g,v,t,_]),S.jsx("div",{children:S.jsx("div",{children:S.jsx("div",{className:"cde-NORMAL",dangerouslySetInnerHTML:{__html:j}})})})});B.propTypes={dataSetId:d.string.isRequired,htmlCode:d.string.isRequired,orgUnitId:d.string.isRequired,periodId:d.string.isRequired,attributeOptionComboSelection:d.object,dataSet:d.shape({displayName:d.string}),initialValues:d.shape({}),metadata:d.object,saveValue:d.func,setHighlightedField:d.func,showDetailsBar:d.func};export{B as default};
//# sourceMappingURL=index-C9rperO1.js.map
