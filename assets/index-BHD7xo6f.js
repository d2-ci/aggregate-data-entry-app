import{y as x,J as Q,r as b,j as g,P as d}from"./index-ChOKem0X.js";const C=["javascripts/jQuery/ui/css/redmond/jquery-ui.css","css/widgets.css","css/dhis-web-dataentry.css"],F=["javascripts/jQuery/jquery.min.js","javascripts/jQuery/placeholders.jquery.min.js","javascripts/jQuery/jquery.utils.js","javascripts/jQuery/jquery.ext.js","javascripts/jQuery/jquery.metadata.js","javascripts/jQuery/jquery.tablesorter.min.js","javascripts/jQuery/jquery.upload-1.0.2.min.js","javascripts/jQuery/jquery.dhisAjaxSelect.js","javascripts/jQuery/ui/jquery-ui.min.js","javascripts/jQuery/ui/jquery.blockUI.js","javascripts/jQuery/jquery.validate.js","javascripts/jQuery/jquery.validate.ext.js","javascripts/jQuery/jquery.cookie.js","javascripts/jQuery/jquery.glob.js","javascripts/jQuery/jquery.date.js","javascripts/jQuery/jquery.tmpl.js","javascripts/jQuery/jquery.autogrow.js","javascripts/jQuery/jquery.fileupload.min.js","javascripts/dhis2/dhis2.util.js","javascripts/dhis2/dhis2.array.js","javascripts/dhis2/dhis2.select.js","javascripts/jQuery/calendars/jquery.calendars.min.js","javascripts/jQuery/calendars/jquery.calendars.plus.min.js","javascripts/floatThead/jquery.floatThead.min.js","javascripts/dhis2/dhis2.period.js","javascripts/dhis2/dhis2.selected.js","javascripts/dhis2/dhis2.comparator.js","javascripts/dhis2/dhis2.availability.js","javascripts/dhis2/dhis2.trigger.js","javascripts/dhis2/dhis2.sharing.js","javascripts/dhis2/dhis2.validation.js","javascripts/dhis2/dhis2.storage.ss.js","javascripts/dhis2/dhis2.storage.ls.js","javascripts/dhis2/dhis2.storage.idb.js","javascripts/dhis2/dhis2.storage.memory.js","javascripts/dhis2/dhis2.storage.js","javascripts/dhis2/dhis2.contextmenu.js","javascripts/dhis2/dhis2.appcache.js","javascripts/dhis2/dhis2.translate.js","javascripts/data-entry/form.js","javascripts/data-entry/entry.js"],E=()=>{const o=F.map(t=>{const s=document.createElement("script");return s.src=`legacy-custom-forms/${t}`,s.async=!1,s}),a=C.map(t=>{const s=document.createElement("link");return s.href=`legacy-custom-forms/${t}`,s.type="text/css",s.rel="stylesheet",s});return{externalScripts:o,externalCSS:a}},I=({periodId:o,dataSetId:a,attributeOptionComboSelection:t,baseUrl:s,metadata:i,orgUnitId:n,hideAlert:w,showAlert:l,setHighlightedField:c})=>{var j,p,m;const u=document.createElement("input");u.id="selectedPeriodId",u.value=o,u.hidden=!0;const h=document.createElement("input");h.id="selectedDataSetId",h.value=a,h.hidden=!0,t&&Object.keys(t).forEach(r=>{const e=document.createElement("input");e.id=`category-${r}`,e.value=t[r],e.hidden=!0,document.body.append(e)}),document.body.append(u,h),window.dhis2.de.currentOrganisationUnitId=n,window.dhis2.de.currentDataSetId=a,window.dhis2.de.currentPeriodId=o,window.dhis2.de.defaultCategoryCombo=(m=(p=(j=Object.values(i.categoryCombos))==null?void 0:j.find)==null?void 0:p.call(j,r=>r.isDefault))==null?void 0:m.id,window.dhis2.de.categories=i.categories,window.dhis2.de.categoryCombos=i.categoryCombos,window.dhis2.de.dataElements=i.dataElements,window.dhis2.de.optionSets=i.optionSets;const v={};for(const[r,e]of Object.entries(i.dataSets))v[r]={...e,periodId:e==null?void 0:e.period};window.dhis2.de.dataSets=v;//! it's also a pseudo-security measure, as it basically ensures that all calls are to the DHIS2 server - no outside API calls
window.DHIS_BASE_URL=s+"/",window.$.ajaxSetup({beforeSend:function(r,e){var y;(y=e.url)!=null&&y.match(s)||(e.url=s+e.url),e.xhrFields={...e.xhrFields,withCredentials:!0}}}),window.dhis2.period.format="$dateFormat.js",window.dhis2.period.calendar=window.$.calendars.instance("gregorian"),window.dhis2.period.generator=new window.dhis2.period.PeriodGenerator(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.period.picker=new window.dhis2.period.DatePicker(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.shim=window.dhis2.shim||{},window.dhis2.shim.showAlert=l,window.dhis2.shim.hideAlert=w,window.setHeaderDelayMessage=r=>{l({message:r})},window.dhis2.shim.metadata=i,window.dhis2.shim.setHighlightedField=c},T=o=>{const a=o.getElementsByTagName("script"),t=o.getElementsByTagName("style"),s=[];return Array.from(a).forEach(i=>{const n=document.createElement("script");n.textContent=i.textContent,n.async=!1,s.push(n),i.remove()}),{scripts:s??[],styles:t??[]}},{externalCSS:P,externalScripts:A}=E(),H=o=>{var e;const{htmlCode:a,metadata:t,periodId:s,dataSetId:i,orgUnitId:n,attributeOptionComboSelection:w,setHighlightedField:l}=o;console.log("[custom-forms] 🏁 Legacy Custom Form Plugin starting 🏁");const c=x(),u=new DOMParser().parseFromString(a,"text/html"),h=T(u),v=u.body.innerHTML,j=h.scripts,p=h.styles,{show:m,hide:r}=Q(({message:y})=>y,{warning:!0});return b.useEffect(()=>{if(!a||!p||!j)return;document.body.append(...A),document.getElementsByTagName("head")[0].append(...P,...p),setTimeout(()=>{var f,S,q;I({periodId:s,dataSetId:i,attributeOptionComboSelection:w,baseUrl:(f=c==null?void 0:c.systemInfo)==null?void 0:f.contextPath,metadata:t,orgUnitId:n,hideAlert:r,showAlert:m,setHighlightedField:l}),document.body.append(...j);//! Kick off everything 🚀
(q=(S=window.dhis2)==null?void 0:S.de)==null||q.loadForm()},1e3)},[(e=c==null?void 0:c.systemInfo)==null?void 0:e.contextPath,i,r,a,t,t.dataSets,n,j,s,m,p,w,l]),g.jsx("div",{children:g.jsx("div",{children:g.jsx("div",{className:"cde-NORMAL",dangerouslySetInnerHTML:{__html:v}})})})};H.propTypes={dataSetId:d.string.isRequired,htmlCode:d.string.isRequired,orgUnitId:d.string.isRequired,periodId:d.string.isRequired,attributeOptionComboSelection:d.object,dataSet:d.shape({displayName:d.string}),initialValues:d.shape({}),metadata:d.object,setHighlightedField:d.func};export{H as default};
//# sourceMappingURL=index-BHD7xo6f.js.map
