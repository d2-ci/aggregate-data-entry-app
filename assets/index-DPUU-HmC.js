import{y as q,J as x,r as S,j as l,P as o}from"./index-ChOKem0X.js";const Q=["javascripts/jQuery/ui/css/redmond/jquery-ui.css","css/widgets.css","css/dhis-web-dataentry.css"],I=["javascripts/jQuery/jquery.min.js","javascripts/jQuery/placeholders.jquery.min.js","javascripts/jQuery/jquery.utils.js","javascripts/jQuery/jquery.ext.js","javascripts/jQuery/jquery.metadata.js","javascripts/jQuery/jquery.tablesorter.min.js","javascripts/jQuery/jquery.upload-1.0.2.min.js","javascripts/jQuery/jquery.dhisAjaxSelect.js","javascripts/jQuery/ui/jquery-ui.min.js","javascripts/jQuery/ui/jquery.blockUI.js","javascripts/jQuery/jquery.validate.js","javascripts/jQuery/jquery.validate.ext.js","javascripts/jQuery/jquery.cookie.js","javascripts/jQuery/jquery.glob.js","javascripts/jQuery/jquery.date.js","javascripts/jQuery/jquery.tmpl.js","javascripts/jQuery/jquery.autogrow.js","javascripts/jQuery/jquery.fileupload.min.js","javascripts/dhis2/dhis2.util.js","javascripts/dhis2/dhis2.array.js","javascripts/dhis2/dhis2.select.js","javascripts/jQuery/calendars/jquery.calendars.min.js","javascripts/jQuery/calendars/jquery.calendars.plus.min.js","javascripts/floatThead/jquery.floatThead.min.js","javascripts/dhis2/dhis2.period.js","javascripts/dhis2/dhis2.selected.js","javascripts/dhis2/dhis2.comparator.js","javascripts/dhis2/dhis2.availability.js","javascripts/dhis2/dhis2.trigger.js","javascripts/dhis2/dhis2.sharing.js","javascripts/dhis2/dhis2.validation.js","javascripts/dhis2/dhis2.storage.ss.js","javascripts/dhis2/dhis2.storage.ls.js","javascripts/dhis2/dhis2.storage.idb.js","javascripts/dhis2/dhis2.storage.memory.js","javascripts/dhis2/dhis2.storage.js","javascripts/dhis2/dhis2.contextmenu.js","javascripts/dhis2/dhis2.appcache.js","javascripts/dhis2/dhis2.translate.js","javascripts/data-entry/form.js","javascripts/data-entry/entry.js"],F=()=>{const a=I.map(t=>{const s=document.createElement("script");return s.src=`legacy-custom-forms/${t}`,s.async=!1,s}),r=Q.map(t=>{const s=document.createElement("link");return s.href=`legacy-custom-forms/${t}`,s.type="text/css",s.rel="stylesheet",s});return{externalScripts:a,externalCSS:r}},C=({periodId:a,dataSetId:r,baseUrl:t,metadata:s,orgUnitId:c,hideAlert:d,showAlert:i})=>{const j=document.createElement("input");j.id="selectedPeriodId",j.value=a,j.hidden=!0;const u=document.createElement("input");u.id="selectedDataSetId",u.value=r,u.hidden=!0,document.body.append(j,u),window.dhis2.de.currentOrganisationUnitId=c,window.dhis2.de.currentDataSetId=r,window.dhis2.de.currentPeriodId=a;const h={};for(const[n,e]of Object.entries(s.dataSets))h[n]={...e,periodId:e==null?void 0:e.period};window.dhis2.de.dataSets=h;//! it's also a pseudo-security measure, as it basically ensures that all calls are to the DHIS2 server - no outside API calls
window.DHIS_BASE_URL=t+"/",window.$.ajaxSetup({beforeSend:function(n,e){var p;(p=e.url)!=null&&p.match(t)||(e.url=t+e.url),e.xhrFields={...e.xhrFields,withCredentials:!0}}}),window.dhis2.period.format="$dateFormat.js",window.dhis2.period.calendar=window.$.calendars.instance("gregorian"),window.dhis2.period.generator=new window.dhis2.period.PeriodGenerator(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.period.picker=new window.dhis2.period.DatePicker(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.shim=window.dhis2.shim||{},window.dhis2.shim.showAlert=i,window.dhis2.shim.hideAlert=d,window.setHeaderDelayMessage=n=>{i({message:n})}},E=a=>{const r=a.getElementsByTagName("script"),t=a.getElementsByTagName("style"),s=[];return Array.from(r).forEach(c=>{const d=document.createElement("script");d.textContent=c.textContent,d.async=!1,s.push(d),c.remove()}),{scripts:s??[],styles:t??[]}},{externalCSS:b,externalScripts:T}=F(),P=a=>{var y;const{htmlCode:r,metadata:t,periodId:s,dataSetId:c,orgUnitId:d}=a;console.log("[custom-forms] 🏁 Legacy Custom Form Plugin starting 🏁");const i=q(),j=new DOMParser().parseFromString(r,"text/html"),u=E(j),h=j.body.innerHTML,n=u.scripts,e=u.styles,{show:p,hide:m}=x(({message:w})=>w,{warning:!0});return S.useEffect(()=>{if(!r||!e||!n)return;document.body.append(...T),document.getElementsByTagName("head")[0].append(...b,...e),setTimeout(()=>{var v,g,f;C({periodId:s,dataSetId:c,baseUrl:(v=i==null?void 0:i.systemInfo)==null?void 0:v.contextPath,metadata:t,orgUnitId:d,hideAlert:m,showAlert:p}),document.body.append(...n);//! Kick off everything 🚀
(f=(g=window.dhis2)==null?void 0:g.de)==null||f.loadForm()},1e3)},[(y=i==null?void 0:i.systemInfo)==null?void 0:y.contextPath,c,m,r,t,t.dataSets,d,n,s,p,e]),l.jsx("div",{children:l.jsx("div",{children:l.jsx("div",{className:"cde-NORMAL",dangerouslySetInnerHTML:{__html:h}})})})};P.propTypes={dataSetId:o.string.isRequired,htmlCode:o.string.isRequired,orgUnitId:o.string.isRequired,periodId:o.string.isRequired,dataSet:o.shape({displayName:o.string}),initialValues:o.shape({}),metadata:o.object};export{P as default};
//# sourceMappingURL=index-DPUU-HmC.js.map
