import{v as e,R as I,y as D,J as T,r as V,j as S,P as d}from"./index-3fssXvim.js";import"./index-DbPbRB15.js";const P=["javascripts/jQuery/ui/css/redmond/jquery-ui.css","css/widgets.css","css/dhis-web-dataentry.css","css/select2/select2.css"],$=["javascripts/jQuery/jquery.min.js","javascripts/jQuery/placeholders.jquery.min.js","javascripts/jQuery/jquery.utils.js","javascripts/jQuery/jquery.ext.js","javascripts/jQuery/jquery.metadata.js","javascripts/jQuery/jquery.tablesorter.min.js","javascripts/jQuery/jquery.upload-1.0.2.min.js","javascripts/jQuery/jquery.dhisAjaxSelect.js","javascripts/jQuery/ui/jquery-ui.min.js","javascripts/jQuery/ui/jquery.blockUI.js","javascripts/jQuery/jquery.validate.js","javascripts/jQuery/jquery.validate.ext.js","javascripts/jQuery/jquery.cookie.js","javascripts/jQuery/jquery.glob.js","javascripts/jQuery/jquery.date.js","javascripts/jQuery/jquery.tmpl.js","javascripts/jQuery/jquery.autogrow.js","javascripts/jQuery/jquery.fileupload.min.js","javascripts/dhis2/dhis2.util.js","javascripts/dhis2/dhis2.array.js","javascripts/dhis2/dhis2.select.js","javascripts/jQuery/calendars/jquery.calendars.min.js","javascripts/jQuery/calendars/jquery.calendars.plus.min.js","javascripts/select2.min.js","javascripts/floatThead/jquery.floatThead.min.js","javascripts/dhis2/dhis2.period.js","javascripts/dhis2/dhis2.validation.js","javascripts/data-entry/form.js","javascripts/data-entry/entry.js"],H=()=>{const l=$.map(r=>{const t=document.createElement("script");return t.src=`legacy-custom-forms/${r}`,t.async=!1,t}),c=P.map(r=>{const t=document.createElement("link");return t.href=`legacy-custom-forms/${r}`,t.type="text/css",t.rel="stylesheet",t});return{externalScripts:l,externalCSS:c}},L=({periodId:l,dataSetId:c,attributeOptionComboSelection:r,baseUrl:t,metadata:a,orgUnitId:u,hideAlert:v,showAlert:h,setHighlightedField:_,saveValue:g,showDetailsBar:f,fileHelper:b})=>{var m,x,j;const n=document.createElement("input");n.id="selectedPeriodId",n.value=l,n.hidden=!0;const p=document.createElement("input");p.id="selectedDataSetId",p.value=c,p.hidden=!0,r&&Object.keys(r).forEach(i=>{const s=document.createElement("input");s.id=`category-${i}`,s.value=r[i],s.hidden=!0,document.body.append(s)}),document.body.append(n,p),window.dhis2.de.currentOrganisationUnitId=u,window.dhis2.de.currentDataSetId=c,window.dhis2.de.currentPeriodId=l,window.dhis2.de.defaultCategoryCombo=(j=(x=(m=Object.values(a.categoryCombos))==null?void 0:m.find)==null?void 0:x.call(m,i=>i.isDefault))==null?void 0:j.id,window.dhis2.de.categories=a.categories,window.dhis2.de.categoryCombos=a.categoryCombos,window.dhis2.de.dataElements=a.dataElements,window.dhis2.de.optionSets=a.optionSets,window.dhis2.de.indicatorFormulas=a.indicators;const y={};for(const[i,s]of Object.entries(a.dataSets))y[i]={...s,periodId:s==null?void 0:s.period};window.dhis2.de.dataSets=y;//! it's also a pseudo-security measure, as it basically ensures that all calls are to the DHIS2 server - no outside API calls
window.DHIS2_BASE_URL=t+"/",window.$.ajaxSetup({beforeSend:function(i,s){var w;(w=s.url)!=null&&w.match(t)||(s.url=t+s.url),s.xhrFields={...s.xhrFields,withCredentials:!0}}}),window.dhis2.period.format="$dateFormat.js",window.dhis2.period.calendar=window.$.calendars.instance("gregorian"),window.dhis2.period.generator=new window.dhis2.period.PeriodGenerator(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.period.picker=new window.dhis2.period.DatePicker(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.shim=window.dhis2.shim||{},window.dhis2.shim.showAlert=h,window.dhis2.shim.hideAlert=v,window.setHeaderDelayMessage=i=>{h({message:i})},window.dhis2.shim.metadata=a,window.dhis2.shim.setHighlightedField=_,window.dhis2.shim.saveValue=(i,s)=>{g(i,s)},window.dhis2.shim.showDetailsBar=f,window.dhis2.shim.fileHelper=b,window.dhis2.shim.i18n_translations={i18n_loading_file_info_failed:e.t("Loading file info failed"),i18n_file_upload_failed:e.t("File upload failed"),i18n_confirm_deletion:e.t("Confirm deletion"),i18n_dataset_is_concluded:e.t("Dataset is concluded"),i18n_dataset_is_closed:e.t("Dataset is closed"),i18n_dataset_is_approved:e.t("Dataset is approved"),i18n_dataset_is_locked:e.t("Dataset is locked"),i18n_orgunit_is_closed:e.t("Org unit is closed"),i18n_select_option:e.t("Choose an option"),i18n_show_all_items:e.t("Show all items"),i18n_value_of_data_element_greater:e.t("The value of the following data element is less than the specified minimum value."),i18n_value_of_data_element_less:e.t("The value of the following data element is greater than the specified maximum value."),i18n_value_too_long:e.t("Value is too long"),i18n_value_must_number:e.t("Value must be a number"),i18n_value_must_integer:e.t("Value must be an integer"),i18n_value_must_positive_integer:e.t("Value must be a  positive integer"),i18n_value_must_negative_integer:e.t("Value must be a negative integer"),i18n_value_must_zero_or_positive_integer:e.t("Value must be zero or a positive integer"),i18n_value_must_coordinate:e.t("Value must be a coordinate (longitude, latitude)"),i18n_value_must_unit_interval:e.t("Value must be a unit interval (between 0 and 1)"),i18n_value_must_percentage:e.t("Value must be a percentage (between 0 and 100)"),i18n_value_must_valid_url:e.t("Value must be a valid url")}},A=l=>{const c=l.getElementsByTagName("script"),r=l.getElementsByTagName("style"),t=[];return Array.from(c).forEach(a=>{const u=document.createElement("script");u.textContent=a.textContent,u.async=!1,t.push(u),a.remove()}),{scripts:t??[],styles:r??[]}},{externalCSS:k,externalScripts:R}=H(),B=I.memo(function(c){var C;const{htmlCode:r,metadata:t,saveValue:a,periodId:u,dataSetId:v,orgUnitId:h,attributeOptionComboSelection:_,setHighlightedField:g,showDetailsBar:f,fileHelper:b}=c;console.log("[custom-forms] üèÅ Legacy Custom Form Plugin starting üèÅ");const n=D(),p=new DOMParser().parseFromString(r,"text/html"),y=A(p);let m=p.body.innerHTML;m=`<div class="plugin-legacy-custom-forms-wrapper">
            <div class="custom-forms-loader">
            <div role="progressbar" class="loader"></div>
        </div>
            <div class="custom-forms-form" style="visibility:hidden">
                ${m}
            </div>
        </div>`;const j=y.scripts,i=y.styles,s=document.createElement("script");s.text=`$(document).ready(() => { 
        $('.plugin-legacy-custom-forms-wrapper .custom-forms-loader').hide()
        $('.plugin-legacy-custom-forms-wrapper .custom-forms-form').attr('style', 'visibility: visible')
    })`,j.push(s);const{show:w,hide:q}=T(o=>(o==null?void 0:o.message)??o,o=>(o==null?void 0:o.alertOptions)??{warning:!0});return V.useEffect(()=>{if(!r||!i||!j)return;document.body.append(...R),document.getElementsByTagName("head")[0].append(...k,...i),setTimeout(()=>{var F,Q,E;L({periodId:u,dataSetId:v,attributeOptionComboSelection:_,baseUrl:(F=n==null?void 0:n.systemInfo)==null?void 0:F.contextPath,metadata:t,orgUnitId:h,hideAlert:q,showAlert:w,setHighlightedField:g,saveValue:a,showDetailsBar:f,fileHelper:b}),document.body.append(...j);//! Kick off everything üöÄ
(E=(Q=window.dhis2)==null?void 0:Q.de)==null||E.loadForm()},1e3)},[(C=n==null?void 0:n.systemInfo)==null?void 0:C.contextPath,v,q,r,t,t.dataSets,h,j,u,w,i,_,g,a,f,b]),S.jsx("div",{children:S.jsx("div",{children:S.jsx("div",{className:"cde-NORMAL",dangerouslySetInnerHTML:{__html:m}})})})});B.propTypes={dataSetId:d.string.isRequired,htmlCode:d.string.isRequired,orgUnitId:d.string.isRequired,periodId:d.string.isRequired,attributeOptionComboSelection:d.object,dataSet:d.shape({displayName:d.string}),fileHelper:d.object,initialValues:d.shape({}),metadata:d.object,saveValue:d.func,setHighlightedField:d.func,showDetailsBar:d.func};export{B as default};
//# sourceMappingURL=index-CrWcT_3p.js.map
