import{v as d,R as I,y as D,J as T,r as P,j as q,P as a}from"./index-ChOKem0X.js";import"./index-Bah48F4K.js";const $=["javascripts/jQuery/ui/css/redmond/jquery-ui.css","css/widgets.css","css/dhis-web-dataentry.css","css/select2/select2.css"],H=["javascripts/jQuery/jquery.min.js","javascripts/jQuery/placeholders.jquery.min.js","javascripts/jQuery/jquery.utils.js","javascripts/jQuery/jquery.ext.js","javascripts/jQuery/jquery.metadata.js","javascripts/jQuery/jquery.tablesorter.min.js","javascripts/jQuery/jquery.upload-1.0.2.min.js","javascripts/jQuery/jquery.dhisAjaxSelect.js","javascripts/jQuery/ui/jquery-ui.min.js","javascripts/jQuery/ui/jquery.blockUI.js","javascripts/jQuery/jquery.validate.js","javascripts/jQuery/jquery.validate.ext.js","javascripts/jQuery/jquery.cookie.js","javascripts/jQuery/jquery.glob.js","javascripts/jQuery/jquery.date.js","javascripts/jQuery/jquery.tmpl.js","javascripts/jQuery/jquery.autogrow.js","javascripts/jQuery/jquery.fileupload.min.js","javascripts/dhis2/dhis2.util.js","javascripts/dhis2/dhis2.array.js","javascripts/dhis2/dhis2.select.js","javascripts/jQuery/calendars/jquery.calendars.min.js","javascripts/jQuery/calendars/jquery.calendars.plus.min.js","javascripts/select2.min.js","javascripts/floatThead/jquery.floatThead.min.js","javascripts/dhis2/dhis2.period.js","javascripts/dhis2/dhis2.validation.js","javascripts/data-entry/form.js","javascripts/data-entry/entry.js"],L=()=>{const c=H.map(r=>{const s=document.createElement("script");return s.src=`legacy-custom-forms/${r}`,s.async=!1,s}),l=$.map(r=>{const s=document.createElement("link");return s.href=`legacy-custom-forms/${r}`,s.type="text/css",s.rel="stylesheet",s});return{externalScripts:c,externalCSS:l}},A=({periodId:c,dataSetId:l,attributeOptionComboSelection:r,baseUrl:s,metadata:i,orgUnitId:u,hideAlert:f,showAlert:h,setHighlightedField:v,saveValue:g,showDetailsBar:_,fileHelper:x})=>{var m,S,j;const o=document.createElement("input");o.id="selectedPeriodId",o.value=c,o.hidden=!0;const p=document.createElement("input");p.id="selectedDataSetId",p.value=l,p.hidden=!0,r&&Object.keys(r).forEach(t=>{const e=document.createElement("input");e.id=`category-${t}`,e.value=r[t],e.hidden=!0,document.body.append(e)}),document.body.append(o,p),window.dhis2.de.currentOrganisationUnitId=u,window.dhis2.de.currentDataSetId=l,window.dhis2.de.currentPeriodId=c,window.dhis2.de.defaultCategoryCombo=(j=(S=(m=Object.values(i.categoryCombos))==null?void 0:m.find)==null?void 0:S.call(m,t=>t.isDefault))==null?void 0:j.id,window.dhis2.de.categories=i.categories,window.dhis2.de.categoryCombos=i.categoryCombos,window.dhis2.de.dataElements=i.dataElements,window.dhis2.de.optionSets=i.optionSets,window.dhis2.de.indicatorFormulas=i.indicators;const y={};for(const[t,e]of Object.entries(i.dataSets))y[t]={...e,periodId:e==null?void 0:e.period};window.dhis2.de.dataSets=y;//! it's also a pseudo-security measure, as it basically ensures that all calls are to the DHIS2 server - no outside API calls
window.DHIS2_BASE_URL=s+"/",window.$.ajaxSetup({beforeSend:function(t,e){var w;(w=e.url)!=null&&w.match(s)||(e.url=s+e.url),e.xhrFields={...e.xhrFields,withCredentials:!0}}}),window.dhis2.period.format="$dateFormat.js",window.dhis2.period.calendar=window.$.calendars.instance("gregorian"),window.dhis2.period.generator=new window.dhis2.period.PeriodGenerator(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.period.picker=new window.dhis2.period.DatePicker(window.dhis2.period.calendar,window.dhis2.period.format),window.dhis2.shim=window.dhis2.shim||{},window.dhis2.shim.showAlert=h,window.dhis2.shim.hideAlert=f,window.setHeaderDelayMessage=t=>{h({message:t})},window.dhis2.shim.metadata=i,window.dhis2.shim.setHighlightedField=v,window.dhis2.shim.saveValue=(t,e)=>{g(t,e)},window.dhis2.shim.showDetailsBar=_,window.dhis2.shim.fileHelper=x,window.dhis2.shim.i18n_translations={i18n_loading_file_info_failed:d.t("Loading file info failed"),i18n_file_upload_failed:d.t("File upload failed"),i18n_confirm_deletion:d.t("Confirm deletion"),i18n_dataset_is_concluded:d.t("Dataset is concluded"),i18n_dataset_is_closed:d.t("Dataset is closed"),i18n_dataset_is_approved:d.t("Dataset is approved"),i18n_dataset_is_locked:d.t("Dataset is locked"),i18n_orgunit_is_closed:d.t("Org unit is closed"),i18n_select_option:d.t("Choose an option"),i18n_show_all_items:d.t("Show all items"),i18n_value_of_data_element_greater:d.t("The value of the following data element is less than the specified minimum value."),i18n_value_of_data_element_less:d.t("The value of the following data element is greater than the specified maximum value.")}},k=c=>{const l=c.getElementsByTagName("script"),r=c.getElementsByTagName("style"),s=[];return Array.from(l).forEach(i=>{const u=document.createElement("script");u.textContent=i.textContent,u.async=!1,s.push(u),i.remove()}),{scripts:s??[],styles:r??[]}},{externalCSS:R,externalScripts:B}=L(),O=I.memo(function(l){var C;const{htmlCode:r,metadata:s,saveValue:i,periodId:u,dataSetId:f,orgUnitId:h,attributeOptionComboSelection:v,setHighlightedField:g,showDetailsBar:_,fileHelper:x}=l;console.log("[custom-forms] üèÅ Legacy Custom Form Plugin starting üèÅ");const o=D(),p=new DOMParser().parseFromString(r,"text/html"),y=k(p);let m=p.body.innerHTML;m=`<div class="plugin-legacy-custom-forms-wrapper">
            <div class="custom-forms-loader">
            <div role="progressbar" class="loader"></div>
        </div>
            <div class="custom-forms-form" style="visibility:hidden">
                ${m}
            </div>
        </div>`;const j=y.scripts,t=y.styles,e=document.createElement("script");e.text=`$(document).ready(() => { 
        $('.plugin-legacy-custom-forms-wrapper .custom-forms-loader').hide()
        $('.plugin-legacy-custom-forms-wrapper .custom-forms-form').attr('style', 'visibility: visible')
    })`,j.push(e);const{show:w,hide:b}=T(n=>(n==null?void 0:n.message)??n,n=>(n==null?void 0:n.alertOptions)??{warning:!0});return P.useEffect(()=>{if(!r||!t||!j)return;document.body.append(...B),document.getElementsByTagName("head")[0].append(...R,...t),setTimeout(()=>{var F,Q,E;A({periodId:u,dataSetId:f,attributeOptionComboSelection:v,baseUrl:(F=o==null?void 0:o.systemInfo)==null?void 0:F.contextPath,metadata:s,orgUnitId:h,hideAlert:b,showAlert:w,setHighlightedField:g,saveValue:i,showDetailsBar:_,fileHelper:x}),document.body.append(...j);//! Kick off everything üöÄ
(E=(Q=window.dhis2)==null?void 0:Q.de)==null||E.loadForm()},1e3)},[(C=o==null?void 0:o.systemInfo)==null?void 0:C.contextPath,f,b,r,s,s.dataSets,h,j,u,w,t,v,g,i,_,x]),q.jsx("div",{children:q.jsx("div",{children:q.jsx("div",{className:"cde-NORMAL",dangerouslySetInnerHTML:{__html:m}})})})});O.propTypes={dataSetId:a.string.isRequired,htmlCode:a.string.isRequired,orgUnitId:a.string.isRequired,periodId:a.string.isRequired,attributeOptionComboSelection:a.object,dataSet:a.shape({displayName:a.string}),fileHelper:a.object,initialValues:a.shape({}),metadata:a.object,saveValue:a.func,setHighlightedField:a.func,showDetailsBar:a.func};export{O as default};
//# sourceMappingURL=index-BD2LCWBS.js.map
