import{R as F,y as b,J as E,r as I,j as S,P as i}from"./index-ChOKem0X.js";const T=["javascripts/jQuery/ui/css/redmond/jquery-ui.css","css/widgets.css","css/dhis-web-dataentry.css","css/select2/select2.css"],A=["javascripts/jQuery/jquery.min.js","javascripts/jQuery/placeholders.jquery.min.js","javascripts/jQuery/jquery.utils.js","javascripts/jQuery/jquery.ext.js","javascripts/jQuery/jquery.metadata.js","javascripts/jQuery/jquery.tablesorter.min.js","javascripts/jQuery/jquery.upload-1.0.2.min.js","javascripts/jQuery/jquery.dhisAjaxSelect.js","javascripts/jQuery/ui/jquery-ui.min.js","javascripts/jQuery/ui/jquery.blockUI.js","javascripts/jQuery/jquery.validate.js","javascripts/jQuery/jquery.validate.ext.js","javascripts/jQuery/jquery.cookie.js","javascripts/jQuery/jquery.glob.js","javascripts/jQuery/jquery.date.js","javascripts/jQuery/jquery.tmpl.js","javascripts/jQuery/jquery.autogrow.js","javascripts/jQuery/jquery.fileupload.min.js","javascripts/dhis2/dhis2.util.js","javascripts/dhis2/dhis2.array.js","javascripts/dhis2/dhis2.select.js","javascripts/jQuery/calendars/jquery.calendars.min.js","javascripts/jQuery/calendars/jquery.calendars.plus.min.js","javascripts/select2.min.js","javascripts/floatThead/jquery.floatThead.min.js","javascripts/data-entry/entry.fileresource.js","javascripts/data-entry/form.js","javascripts/data-entry/entry.js"],P=()=>{const n=A.map(a=>{const s=document.createElement("script");return s.src=`legacy-custom-forms/${a}`,s.async=!1,s}),o=T.map(a=>{const s=document.createElement("link");return s.href=`legacy-custom-forms/${a}`,s.type="text/css",s.rel="stylesheet",s});return{externalScripts:n,externalCSS:o}},D=({periodId:n,dataSetId:o,attributeOptionComboSelection:a,baseUrl:s,metadata:t,orgUnitId:c,hideAlert:w,showAlert:y,setHighlightedField:g,saveValue:v,showDetailsBar:f})=>{var j,l,m;const d=document.createElement("input");d.id="selectedPeriodId",d.value=n,d.hidden=!0;const u=document.createElement("input");u.id="selectedDataSetId",u.value=o,u.hidden=!0,a&&Object.keys(a).forEach(r=>{const e=document.createElement("input");e.id=`category-${r}`,e.value=a[r],e.hidden=!0,document.body.append(e)}),document.body.append(d,u),window.dhis2.de.currentOrganisationUnitId=c,window.dhis2.de.currentDataSetId=o,window.dhis2.de.currentPeriodId=n,window.dhis2.de.defaultCategoryCombo=(m=(l=(j=Object.values(t.categoryCombos))==null?void 0:j.find)==null?void 0:l.call(j,r=>r.isDefault))==null?void 0:m.id,window.dhis2.de.categories=t.categories,window.dhis2.de.categoryCombos=t.categoryCombos,window.dhis2.de.dataElements=t.dataElements,window.dhis2.de.optionSets=t.optionSets,window.dhis2.de.indicatorFormulas=t.indicators;const p={};for(const[r,e]of Object.entries(t.dataSets))p[r]={...e,periodId:e==null?void 0:e.period};window.dhis2.de.dataSets=p;//! it's also a pseudo-security measure, as it basically ensures that all calls are to the DHIS2 server - no outside API calls
window.DHIS_BASE_URL=s+"/",window.$.ajaxSetup({beforeSend:function(r,e){var h;(h=e.url)!=null&&h.match(s)||(e.url=s+e.url),e.xhrFields={...e.xhrFields,withCredentials:!0}}}),window.dhis2.shim=window.dhis2.shim||{},window.dhis2.shim.showAlert=y,window.dhis2.shim.hideAlert=w,window.setHeaderDelayMessage=r=>{y({message:r})},window.dhis2.shim.metadata=t,window.dhis2.shim.setHighlightedField=g,window.dhis2.shim.saveValue=(r,e)=>{v(r,e)},window.dhis2.shim.showDetailsBar=f},R=n=>{const o=n.getElementsByTagName("script"),a=n.getElementsByTagName("style"),s=[];return Array.from(o).forEach(t=>{const c=document.createElement("script");c.textContent=t.textContent,c.async=!1,s.push(c),t.remove()}),{scripts:s??[],styles:a??[]}},{externalCSS:B,externalScripts:H}=P(),L=F.memo(function(o){var h;const{htmlCode:a,metadata:s,saveValue:t,periodId:c,dataSetId:w,orgUnitId:y,attributeOptionComboSelection:g,setHighlightedField:v,showDetailsBar:f}=o;console.log("[custom-forms] ðŸ Legacy Custom Form Plugin starting ðŸ");const d=b(),u=new DOMParser().parseFromString(a,"text/html"),p=R(u),j=u.body.innerHTML,l=p.scripts,m=p.styles,{show:r,hide:e}=E(({message:q})=>q,{warning:!0});return I.useEffect(()=>{if(!a||!m||!l)return;document.body.append(...H),document.getElementsByTagName("head")[0].append(...B,...m),setTimeout(()=>{var x,Q,C;D({periodId:c,dataSetId:w,attributeOptionComboSelection:g,baseUrl:(x=d==null?void 0:d.systemInfo)==null?void 0:x.contextPath,metadata:s,orgUnitId:y,hideAlert:e,showAlert:r,setHighlightedField:v,saveValue:t,showDetailsBar:f}),document.body.append(...l);//! Kick off everything ðŸš€
(C=(Q=window.dhis2)==null?void 0:Q.de)==null||C.loadForm()},1e3)},[(h=d==null?void 0:d.systemInfo)==null?void 0:h.contextPath,w,e,a,s,s.dataSets,y,l,c,r,m,g,v,t,f]),S.jsx("div",{children:S.jsx("div",{children:S.jsx("div",{className:"cde-NORMAL",dangerouslySetInnerHTML:{__html:j}})})})});L.propTypes={dataSetId:i.string.isRequired,htmlCode:i.string.isRequired,orgUnitId:i.string.isRequired,periodId:i.string.isRequired,attributeOptionComboSelection:i.object,dataSet:i.shape({displayName:i.string}),initialValues:i.shape({}),metadata:i.object,saveValue:i.func,setHighlightedField:i.func,showDetailsBar:i.func};export{L as default};
//# sourceMappingURL=index-b6o4N2Wu.js.map
